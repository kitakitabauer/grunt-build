var http=require("http"),fs=require("fs"),socketio=require("socket.io"),setting=require("./999_param.js"),server=http.createServer(),io=socketio.listen(server),MEMBER={},setMember=function(a,b){MEMBER[a]=b},deleteMember=function(a){delete MEMBER[a]},modifyMember=function(a,b){void 0!==MEMBER[a]&&(MEMBER[a]=b)},getMember=function(){var a="";for(var b in MEMBER)a+=MEMBER[b]+", ";return console.log("result : "+a),a};server.on("request",function(a,b){fs.readFile("./044_client.html",function(a,c){a&&(console.log(a),b.writeHead(500),b.end("Server error : "+a)),b.writeHead(200,{"Content-Type":"text/html; charset=UTF-8"}),b.end(c)})}),server.listen(setting.PORT,setting.IP,setting.startServer),io.sockets.on("connection",function(a){setMember(a.id,"名無し"),io.sockets.emit("rewriteMember",getMember()),a.on("addMenber",function(b){console.log("name : "+b),console.log(a.id),setMember(a.id,b),io.sockets.emit("rewriteMember",getMember())}),a.on("modifyName",function(b){console.log("modify name : "+b),console.log(a.id),modifyMember(a.id,b),io.sockets.emit("rewriteMember",getMember())}),a.on("disconnect",function(){deleteMember(a.id),io.sockets.emit("rewriteMember",getMember())})});